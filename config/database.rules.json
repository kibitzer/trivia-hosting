{
  "rules": {
    "gameState": {
      ".read": "auth != null",
      ".write": "auth != null && auth.token.firebase.sign_in_provider != 'anonymous'",
      ".validate": "newData.hasChildren(['status'])"
    },
    "quizzes": {
      // Players need to read quiz metadata sometimes, or Host can read all
      ".read": "auth != null",
      // Only the Host can create/edit/delete quizzes
      ".write": "auth != null && auth.token.firebase.sign_in_provider != 'anonymous'"
    },
    "players": {
      ".read": "auth != null",
      ".write": "auth != null && auth.token.firebase.sign_in_provider != 'anonymous'",
      "$uid": {
        "name": { 
          ".write": "auth != null && (auth.uid === $uid || auth.token.firebase.sign_in_provider != 'anonymous')",
          ".validate": "newData.isString() && newData.val().length <= 20" 
        },
        "score": { 
          ".write": "auth != null && auth.token.firebase.sign_in_provider != 'anonymous'",
          ".validate": "newData.isNumber()" 
        },
        "online": { 
          ".write": "auth != null && (auth.uid === $uid || auth.token.firebase.sign_in_provider != 'anonymous')",
          ".validate": "newData.isBoolean()" 
        },
        "joinedAt": {
          ".write": "auth != null && (auth.uid === $uid || auth.token.firebase.sign_in_provider != 'anonymous')"
        }
      }
    },
    "answers": {
      ".read": "auth != null && auth.token.firebase.sign_in_provider != 'anonymous'",
      ".write": "auth != null && auth.token.firebase.sign_in_provider != 'anonymous'",
      "$questionId": {
        "$uid": {
          ".write": "auth != null && auth.uid === $uid && root.child('gameState/timerStatus').val() === 'running'",
          ".validate": "newData.hasChildren(['answer', 'timestamp'])"
        }
      }
    }
  }
}
